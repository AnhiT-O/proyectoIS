{% extends 'base.html' %}
{% load static %}

{% block title %}Editar Recargos - Global Exchange{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'claro/formularios.css' %}" media="(prefers-color-scheme: light)">
<link rel="stylesheet" href="{% static 'oscuro/formularios.css' %}" media="(prefers-color-scheme: dark)">
{% endblock %}

{% block content %}
<div class="contenido">
    <div class="form-cabecera">
        <h1>Editar Recargos</h1>
        <p class="subtitulo">Configura los recargos por tipo de medio de pago</p>
    </div>
    
        <form method="post" novalidate>
            {% csrf_token %}
            
            {% for recargo in recargos %}
                <div class="form-campo">
                    <label for="recargo_{{ recargo.id }}">
                        {{ recargo.nombre }}
                    </label>
                    <div class="recargo-input-group">
                        <input 
                            type="number" 
                            id="recargo_{{ recargo.id }}"
                            name="recargo_{{ recargo.id }}"
                            value="{{ recargo.recargo }}"
                            min="0" 
                            max="100" 
                            step="1"
                            class="form-control"
                            required
                        >
                    </div>
                </div>
            {% endfor %}
            
            <div class="zona-botones">
                <button type="submit" class="btn-primario">
                    Guardar Cambios
                </button>
                <a href="{% url 'monedas:lista_limites' %}" class="btn-secundario">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Validación en tiempo real
    const inputs = document.querySelectorAll('.recargo-input');
    
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            const value = parseInt(this.value);
            
            // Remover clases de error previas
            this.classList.remove('error');
            
            // Validar rango
            if (isNaN(value) || value < 0 || value > 100) {
                this.classList.add('error');
                this.style.borderColor = 'var(--color-error)';
            } else {
                this.style.borderColor = 'var(--color-borde)';
            }
        });
        
        // Validar al perder el foco
        input.addEventListener('blur', function() {
            const value = parseInt(this.value);
            
            if (isNaN(value) || value < 0) {
                this.value = 0;
            } else if (value > 100) {
                this.value = 100;
            }
        });
    });
    
    // Validación antes de enviar el formulario
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            let hasErrors = false;
            
            inputs.forEach(input => {
                const value = parseInt(input.value);
                if (isNaN(value) || value < 0 || value > 100) {
                    hasErrors = true;
                    input.style.borderColor = 'var(--color-error)';
                }
            });
            
            if (hasErrors) {
                e.preventDefault();
                alert('Por favor, corrija los valores incorrectos antes de guardar. Los recargos deben estar entre 0 y 100%.');
            }
        });
    }
});
</script>
{% endblock %}