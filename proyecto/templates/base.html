<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Global Exchange{% endblock %}</title>
    {% load static %}
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="stylesheet" href="{% static 'claro/global.css' %}" media="(prefers-color-scheme: light)">
    <link rel="stylesheet" href="{% static 'oscuro/global.css' %}" media="(prefers-color-scheme: dark)">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Barra de navegaci贸n -->
    {% block navbar %}
    <nav class="zona-barra">
        <div class="barra-contenido">
            <a href="{% url 'inicio' %}" class="barra-logo">
                 Global Exchange
            </a>
            
            <div class="barra-navegacion">
                {% if user.is_authenticated %}
                    <div class="zona-usuario">
                        <span class="usuario-nombre">Hola, {{ user.first_name }}!</span>

                        <!-- Panel de Administraci贸n basado en permisos -->
                        {% if perms.usuarios or perms.clientes or perms.roles or perms.monedas %}
                            <div class="panel-gestiones">
                                <a href="#" class="btn-panel" onclick="toggleAdminMenu(event)">
                                    锔 Panel de Gestiones
                                </a>
                                <div class="gestion-menu" id="adminMenu">
                                    <!-- Gesti贸n de Usuarios -->
                                    {% if perms.usuarios %}
                                        <a href="{% url 'usuarios:administrar_usuarios' %}" class="gestion-seleccion">
                                             Gestionar Usuarios
                                        </a>
                                    {% endif %}
                                    
                                    <!-- Gesti贸n de Roles -->
                                    {% if perms.roles %}
                                        <a href="{% url 'roles:listar_roles' %}" class="gestion-seleccion">
                                             Gestionar Roles
                                        </a>
                                    {% endif %}
                                    
                                    <!-- Gesti贸n de Clientes -->
                                    {% if perms.clientes %}
                                        <a href="{% url 'clientes:cliente_lista' %}" class="gestion-seleccion">
                                             Gestionar Clientes
                                        </a>
                                    {% endif %}
                                    
                                    <!-- Gesti贸n de Monedas -->
                                    {% if perms.monedas %}
                                        <a href="{% url 'monedas:lista_monedas' %}" class="gestion-seleccion">
                                             Gestionar Monedas
                                        </a>
                                    {% endif %}
                                    
                                    <!-- Gesti贸n de L铆mites -->
                                    {% if perms.monedas.gestion %}
                                        <a href="{% url 'monedas:lista_limites' %}" class="gestion-seleccion">
                                             Gestionar L铆mites
                                        </a>
                                    {% endif %}
                                  
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Mostrar Ver Clientes solo si el usuario tiene clientes asociados -->
                        {% if user.clientes_operados.exists %}
                            <a href="{% url 'usuarios:mis_clientes' %}" class="btn-panel">
                                 Ver Clientes
                            </a>
                        {% endif %}
                        
                        <a href="{% url 'usuarios:perfil' %}" class="btn-secundario">
                             Mi Perfil
                        </a>
                        <a href="{% url 'logout' %}" class="btn-primario">
                             Cerrar Sesi贸n
                        </a>
                    </div>
                {% else %}
                    <a href="{% url 'login' %}" class="btn-secundario">
                        Iniciar Sesi贸n
                    </a>
                    <a href="{% url 'usuarios:registro' %}" class="btn-primario">
                        Registrarse
                    </a>
                {% endif %}
            </div>
        </div>
    </nav>
    {% endblock %}

    <!-- Mensajes del sistema -->
    {% if messages %}
        <div class="zona-alertas">
            {% for message in messages %}
                <div class="alerta-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Contenido principal -->
    <main class="cuerpo">
        {% block content %}{% endblock %}
    </main>

    {% block extra_js %}{% endblock %}
    
    <script src="{% static 'global.js' %}"></script>
</body>
</html>