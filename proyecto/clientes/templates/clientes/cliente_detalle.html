{% extends 'base.html' %}
{% load static %}

{% block title %}{{ cliente.nombre }} - Global Exchange{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'claro/detalles.css' %}" media="(prefers-color-scheme: light)">
<link rel="stylesheet" href="{% static 'oscuro/detalles.css' %}" media="(prefers-color-scheme: dark)">
{% endblock %}

{% block content %}
<div class="contenido">
    <div class="detalle-cabecera">
        <h1 class="detalle-nombre">
                {{ cliente.nombre }}
        </h1>
        <div class="detalle-tipo">
            {{ cliente.get_tipoCliente_display }}
        </div>
    </div>

    <div class="zona-detalle">
        <div class="seccion-info">
            <!-- Informaci√≥n Personal -->
            <div class="info-columna">
                <div class="info-celda">
                    <span class="info-icono">üìÑ</span>
                    <div class="info-contenido">
                        <div class="info-titulo">Tipo de Documento</div>
                        <div class="info-valor">{{ cliente.get_tipoDocCliente_display }}</div>
                    </div>
                </div>
                <div class="info-celda">
                    <span class="info-icono">üî¢</span>
                    <div class="info-contenido">
                        <div class="info-titulo">N√∫mero de Documento</div>
                        <div class="info-valor">{{ cliente.docCliente }}</div>
                    </div>
                </div>
                <div class="info-celda">
                    <span class="info-icono">üè∑Ô∏è</span>
                    <div class="info-contenido">
                        <div class="info-titulo">Segmento</div>
                        <div class="info-valor">{{ cliente.get_segmento_display }}</div>
                    </div>
                </div>
                <div class="info-celda">
                    <span class="info-icono">üéÅ</span>
                    <div class="info-contenido">
                        <div class="info-titulo">Beneficio aplicado</div>
                        <div class="info-valor">
                            {% if cliente.beneficio_segmento > 0 %}
                                {{ cliente.beneficio_segmento }}%
                            {% else %}
                                Ninguno
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Informaci√≥n de Contacto -->
            <div class="info-columna">
                <div class="info-celda">
                    <span class="info-icono">üìß</span>
                    <div class="info-contenido">
                        <div class="info-titulo">Correo Electr√≥nico</div>
                        <div class="info-valor">{{ cliente.correoElecCliente }}</div>
                    </div>
                </div>
                <div class="info-celda">
                    <span class="info-icono">üìû</span>
                    <div class="info-contenido">
                        <div class="info-titulo">Tel√©fono</div>
                        <div class="info-valor">{{ cliente.telefono }}</div>
                    </div>
                </div>
                <div class="info-celda">
                    <span class="info-icono">üè†</span>
                    <div class="info-contenido">
                        <div class="info-titulo">Domicilio</div>
                        <div class="info-valor">{{ cliente.direccion|default:"No especificado" }}</div>
                    </div>
                </div>
                <div class="info-celda">
                    <span class="info-icono">üíº</span>
                    <div class="info-contenido">
                        <div class="info-titulo">Ocupaci√≥n</div>
                        <div class="info-valor">{{ cliente.ocupacion|default:"No especificada" }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estado de Declaraci√≥n Jurada -->
        <div class="info-columna" style="grid-column: 1 / -1;">
            <div class="info-celda">
                <span class="info-icono">üìù</span>
                <div class="info-contenido">
                    <div class="info-titulo">Estado de Declaraci√≥n Jurada</div>
                    <div class="info-valor">
                        {% if cliente.declaracion_jurada %}
                            <span class="etiqueta-activo">
                                Declaraci√≥n Firmada
                            </span>
                        {% else %}
                            <span class="etiqueta-bloqueado">
                                Declaraci√≥n Pendiente
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Secci√≥n de Medios de Pago -->
    <div class="zona-detalle" style="margin-top: 2rem;">
        <div class="detalle-cabecera" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2 style="margin: 0; color: var(--color-texto-principal); font-size: 1.5rem;">Medios de Pago Asociados</h2>
            <div style="display: flex; gap: 0.5rem;">
                {% if puede_agregar_tarjeta %}
                    <a href="{% url 'clientes:cliente_agregar_tarjeta' cliente.pk %}" class="btn-primario" style="font-size: 0.9rem; padding: 0.5rem 1rem; border: 2px solid white; color: white;">
                        Agregar Tarjeta
                    </a>
                {% endif %}
                {% if not medios_por_tipo.transferencia.0.cuenta_bancaria_completa %}
                    <a href="{% url 'clientes:cliente_agregar_cuenta' cliente.pk %}" class="btn-primario" style="font-size: 0.9rem; padding: 0.5rem 1rem; border: 2px solid white; color: white;">
                        Agregar Cuenta
                    </a>
                {% endif %}
            </div>
        </div>

        {% if medios_pago %}
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                <!-- Efectivo -->
                {% for medio in medios_por_tipo.efectivo %}
                <div class="info-celda" style="border-left: 4px solid #28a745; background: var(--color-fondo-tarjeta); border-radius: 8px; padding: 1rem; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 1.5rem; margin-right: 0.5rem;"></span>
                        <div style="flex: 1;">
                            <div class="info-titulo" style="margin-bottom: 8px;">Efectivo</div>
                        </div>
                    </div>
                    
                    <!-- Estado -->
                    <div style="margin-bottom: 1rem;">
                        {% if medio.activo %}
                            <span class="etiqueta-activo">Disponible</span>
                        {% else %}
                            <span class="etiqueta-bloqueado">Desactivado</span>
                        {% endif %}
                    </div>
                    
                    <!-- Bot√≥n Activar/Desactivar -->
                    <div>
                        <form method="post" action="{% url 'clientes:cliente_cambiar_estado_medio_pago' cliente.pk medio.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="{% if medio.activo %}btn-desactivar{% else %}btn-activar{% endif %}">
                                {% if medio.activo %}Desactivar{% else %}Activar{% endif %}
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}

                <!-- Cheques -->
                {% for medio in medios_por_tipo.cheque %}
                <div class="info-celda" style="border-left: 4px solid #17a2b8; background: var(--color-fondo-tarjeta); border-radius: 8px; padding: 1rem; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 1.5rem; margin-right: 0.5rem;"></span>
                        <div style="flex: 1;">
                            <div class="info-titulo" style="margin-bottom: 8px;">Cheque</div>
                        </div>
                    </div>
                    
                    <!-- Estado -->
                    <div style="margin-bottom: 1rem;">
                        {% if medio.activo %}
                            <span class="etiqueta-activo">Disponible</span>
                        {% else %}
                            <span class="etiqueta-bloqueado">Inactivo</span>
                        {% endif %}
                    </div>
                    
                    <!-- Bot√≥n Activar/Desactivar -->
                    <div>
                        <form method="post" action="{% url 'clientes:cliente_cambiar_estado_medio_pago' cliente.pk medio.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="{% if medio.activo %}btn-desactivar{% else %}btn-activar{% endif %}">
                                {% if medio.activo %}Desactivar{% else %}Activar{% endif %}
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}

                <!-- Transferencias -->
                {% for medio in medios_por_tipo.transferencia %}
                    {% if medio.cuenta_bancaria_completa or not tiene_cuentas_configuradas %}
                <div class="info-celda" style="border-left: 4px solid #007bff; background: var(--color-fondo-tarjeta); border-radius: 8px; padding: 1rem; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <span style="font-size: 1.5rem; margin-right: 0.5rem;"></span>
                        <div style="flex: 1;">
                            <div class="info-titulo">Transferencia Bancaria</div>
                        </div>
                    </div>
                    
                    <!-- Estado -->
                    <div style="margin-bottom: 1rem;">
                        {% if medio.cuenta_bancaria_completa %}
                            {% if medio.activo %}
                                <span class="etiqueta-activo">Disponible</span>
                            {% else %}
                                <span class="etiqueta-bloqueado">Inactiva</span>
                            {% endif %}
                        {% else %}
                            <span class="etiqueta-bloqueado">Sin configurar</span>
                        {% endif %}
                    </div>
                    
                    {% if medio.cuenta_bancaria_completa %}
                        <!-- Informaci√≥n detallada -->
                        <div style="color: var(--color-texto-secundario); font-size: 0.875rem; line-height: 1.4; margin-bottom: 1rem;">
                            <div style="margin-bottom: 0.25rem;">Cuenta: {{ medio.numero_cuenta_oculto }}</div>
                            <div>Titular: {{ medio.nombre_titular_cuenta }}</div>
                        </div>
                        
                        <!-- Botones -->
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <form method="post" action="{% url 'clientes:cliente_cambiar_estado_medio_pago' cliente.pk medio.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="{% if medio.activo %}btn-desactivar{% else %}btn-activar{% endif %}">
                                    {% if medio.activo %}Desactivar{% else %}Activar{% endif %}
                                </button>
                            </form>
                        </div>
                    {% endif %}
                </div>
                    {% endif %}
                {% endfor %}

                <!-- Tarjetas de Cr√©dito -->
                {% for medio in medios_por_tipo.tarjeta_credito %}
                <div class="info-celda" style="border-left: 4px solid #6c757d; background: var(--color-fondo-tarjeta); border-radius: 8px; padding: 1rem; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <span style="font-size: 1.5rem; margin-right: 0.5rem;"></span>
                        <div style="flex: 1;">
                            <div class="info-titulo">Tarjeta de Cr√©dito</div>
                        </div>
                    </div>
                    
                    <!-- Estado -->
                    <div style="margin-bottom: 1rem;">
                        {% if medio.activo %}
                            <span class="etiqueta-activo">Activa</span>
                        {% else %}
                            <span class="etiqueta-bloqueado">Inactiva</span>
                        {% endif %}
                    </div>
                    
                    <!-- Informaci√≥n detallada -->
                    <div style="color: var(--color-texto-secundario); font-size: 0.875rem; line-height: 1.4; margin-bottom: 1rem;">
                        <div style="margin-bottom: 0.25rem;">{{ medio.numero_tarjeta_oculto }}</div>
                        <div style="margin-bottom: 0.25rem;">{{ medio.nombre_titular_tarjeta }}</div>
                        <div>{{ medio.get_moneda_tc_display }}</div>
                        {% if es_administrador and medio.cvv_tarjeta_oculto %}
                            <div style="margin-top: 0.25rem;">CVV: {{ medio.cvv_tarjeta_oculto }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Botones -->
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <form method="post" action="{% url 'clientes:cliente_cambiar_estado_medio_pago' cliente.pk medio.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="{% if medio.activo %}btn-desactivar{% else %}btn-activar{% endif %}">
                                {% if medio.activo %}Desactivar{% else %}Activar{% endif %}
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}

                <!-- Billeteras Electr√≥nicas -->
                {% for medio in medios_por_tipo.billetera_electronica %}
                <div class="info-celda" style="border-left: 4px solid #ffc107; background: var(--color-fondo-tarjeta); border-radius: 8px; padding: 1rem; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 1.5rem; margin-right: 0.5rem;"></span>
                        <div style="flex: 1;">
                            <div class="info-titulo" style="margin-bottom: 8px;">Billetera Electr√≥nica</div>
                        </div>
                    </div>
                    
                    <!-- Estado -->
                    <div style="margin-bottom: 1rem;">
                        {% if medio.activo %}
                            <span class="etiqueta-activo">Activa</span>
                        {% else %}
                            <span class="etiqueta-bloqueado">Inactiva</span>
                        {% endif %}
                    </div>
                    
                    <!-- Botones -->
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <form method="post" action="{% url 'clientes:cliente_cambiar_estado_medio_pago' cliente.pk medio.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="{% if medio.activo %}btn-desactivar{% else %}btn-activar{% endif %}">
                                {% if medio.activo %}Desactivar{% else %}Activar{% endif %}
                            </button>
                        </form> 
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 2rem; background: var(--color-fondo-tarjeta); border-radius: 8px; border: 1px solid var(--color-borde);">
                <span style="font-size: 3rem; opacity: 0.5;"></span>
                <h3 style="color: var(--color-texto-secundario); margin: 1rem 0 0.5rem 0;">Sin medios de pago</h3>
                <p style="color: var(--color-texto-secundario); margin: 0;">Este cliente no tiene medios de pago asociados.</p>
            </div>
        {% endif %}
    </div>

    <div class="zona-acciones">
        <div class="acciones-contenido">
            <a href="{% url 'clientes:cliente_editar' cliente.pk %}" class="btn-primario">
                Editar Cliente
            </a>
            <a href="{% url 'clientes:cliente_lista' %}" class="btn btn-secundario">
                Volver a la Lista
            </a>
        </div>
    </div>
</div>

{% endblock %}